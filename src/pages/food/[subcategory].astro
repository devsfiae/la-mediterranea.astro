---
import { getCollection } from 'astro:content';
import Header from '../../components/Header.astro';
import '../../styles/global.css';
import '../../styles/card.css';

export async function getStaticPaths() {
    const items = await getCollection('menu');
    const foodItems = items.filter(item => item.data.category_name.toLowerCase() === 'food');
    const uniqueSubcategoryIds = Array.from(new Set(foodItems.map(item => item.data.subcategory_id)));

    // Log the paths generated
    console.log("Generated paths for subcategory IDs:", uniqueSubcategoryIds);

    return uniqueSubcategoryIds.map(subcategoryId => ({
        params: { subcategory: subcategoryId },
    }));
}

const { subcategory } = Astro.params;
const items = await getCollection('menu');
const filteredFoodItems = items.filter(item => 
    item.data.category_name.toLowerCase() === 'food' &&
    item.data.subcategory_id === subcategory
);
---

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Food - {subcategory} @La Mediterranea</title>
</head>

<body>
    <Header />
    <main class="main-content">
        <h1>{subcategory} Food</h1>

        <!-- Display filtered food items for the subcategory -->
        <div class="card-container">
            {filteredFoodItems.map((food) => (
                <div class="card" key={food.id}>
                    <div class="card-header">
                        <h3 class="card-title">{food.data.item_name}</h3>
                        <img class="card-image" src={food.data.image_path || '/images/icons/no_picture.png'} alt={food.data.item_name} />
                    </div>
                    <p>{food.data.description}</p>
                    <div class="divider-gradient"></div>
                    <div class="card-price"><strong>{food.data.menu_price}</strong></div>
                    <p class="card-description">{food.data.volume} l</p>
                </div>
            ))}
        </div>
    </main>
</body>
</html>